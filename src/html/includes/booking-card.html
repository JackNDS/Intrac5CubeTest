<%
/* COLORS / VARIANTS */
var variants = {
privateLessons:    { outerBg: "bg-green",        innerBg: "bg-green-100" },
seasonBooking:     { outerBg: "bg-yellow",       innerBg: "bg-yellow-100" },
normalBooking:     { outerBg: "bg-blue",         innerBg: "bg-blue-100" },
completedBookings: { outerBg: "bg-gray",         innerBg: "bg-gray-100" },
events:            { outerBg: "bg-purple-dark",  innerBg: "bg-purple-100" }
};

/* HEIGHTS (row = 80px) */
var rowHeight = 80;
var fixedHeightsPx = { "15min": 16.5, "30min": 35, "45min": 53.5, "1h": rowHeight - 10 };

var heightPx;
if (fixedHeightsPx[timeRange]) {
heightPx = fixedHeightsPx[timeRange];
} else if ((timeRange || "").endsWith("h")) {
var hours = Math.max(1, parseInt(timeRange, 10) || 1);
heightPx = rowHeight * hours - 10;
} else {
heightPx = rowHeight;
}

var spanCourts = Math.max(1, parseInt(corts || 1, 10));
var v = variants[variant] || variants.normalBooking;
var isShort = timeRange === "15min";

/* NEW: stacking controls */
var stackIndex = Number(typeof stackIndex !== 'undefined' ? stackIndex : 0);
var gapPx = Number(typeof gapPx !== 'undefined' ? gapPx : 2);
var topPx = stackIndex * (heightPx + gapPx);
%>

<!-- absolute card that can span horizontally and stack vertically -->
<!-- parent <td> must be class="relative" -->
<div
  class="absolute left-0 z-1 m-1
         top-[var(--card-top)]
         w-[calc(99%*var(--card-span))]
         h-[var(--card-height)]"
  style="--card-span:<%= spanCourts %>; --card-height:<%= heightPx %>px; --card-top:<%= topPx %>px;"
>
  <div class="flex justify-end h-full relative rounded-md shadow-sm min-h-[16px] <%= v.outerBg %>">
    <div class="w-[99%] py-[2px] px-1.5 relative z-10 rounded-md <%= v.innerBg %> shadow-sm p-6 <%= isShort ? 'flex items-center' : 'flex flex-col' %>">
      <h3 class="flex items-center text-[.85rem] justify-between w-full leading-4">
        <span class="truncate"><%= title %></span>

        <% if (isPaymentDone) { %>
        <!-- Done icon -->
        <svg title="done" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M7.5 9.5L6 8" stroke="#43A047" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M10 7L7.5 9.5" stroke="#43A047" stroke-linecap="round" stroke-linejoin="round"/>
          <path fill-rule="evenodd" clip-rule="evenodd" d="M8 14C4.6863 14 2 11.3137 2 8V8C2 4.68629 4.6863 2 8 2V2C11.3137 2 14 4.68629 14 8V8C14 11.3137 11.3137 14 8 14V14Z" stroke="#43A047" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <% } else { %>
        <!-- Attention icon -->
        <svg title="attention" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M7.99966 10.6667C7.90766 10.6667 7.83299 10.7413 7.83366 10.8333C7.83366 10.9253 7.90833 11 8.00033 11C8.09233 11 8.16699 10.9253 8.16699 10.8333C8.16699 10.7413 8.09233 10.6667 7.99966 10.6667" stroke="#F36A6A" stroke-linecap="round" stroke-linejoin="round"/>
          <path fill-rule="evenodd" clip-rule="evenodd" d="M8 14V14C4.686 14 2 11.314 2 8V8C2 4.686 4.686 2 8 2V2C11.314 2 14 4.686 14 8V8C14 11.314 11.314 14 8 14Z" stroke="#F36A6A" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M8.00033 5.16675V8.50008" stroke="#F36A6A" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <% } %>
      </h3>

      <% if (!isShort) { %>
      <p class="text-[.85rem] text-gray leading-4"><%= time %></p>
      <% } %>
    </div>
  </div>
</div>

